<!DOCTYPE html>
<html>
<head>
    <title>增强版颜色转换器</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .converter-box { background: #f0f2f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
        input { width: calc(100% - 22px); padding: 10px; margin: 5px 0; border: 2px solid #ddd; }
        input:valid { border-color: #4CAF50; }
        input:invalid { border-color: #ff6347; }
        button { padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer; margin: 5px; }
        .preview-box { height: 50px; margin: 10px 0; transition: all 0.3s; }
        .result { font-size: 1.2em; margin: 10px 0; }
        .color-picker { position: relative; }
        .color-info { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; text-shadow: 1px 1px 2px #000; }
    </style>
</head>
<body>
    <!-- 顶部实时取色器 -->
    <div class="converter-box color-picker">
        <h2>实时颜色预览</h2>
        <input type="text" id="colorInput" placeholder="输入任何颜色值（支持RGB/HEX/颜色名称）">
        <div class="preview-box" id="livePreview">
            <div class="color-info" id="colorInfo">预览区域</div>
        </div>
    </div>

    <div class="converter-box">
        <h2>RGB/RGBA 转换</h2>
        <input type="text" id="rgbInput" placeholder="输入RGB值（如：150,174,216 或 255,0,0,0.5）" pattern="^\s*\d+\s*,\s*\d+\s*,\s*\d+\s*(,\s*[\d.]+\s*)?$">
        <button onclick="convertRgb()">转换为HEX</button>
        <div class="preview-box" id="rgbPreview"></div>
        <div class="result" id="rgbResult"></div>
    </div>

    <div class="converter-box">
        <h2>HEX 转换</h2>
        <input type="text" id="hexInput" placeholder="输入十六进制（如：#000000 或 #000）" pattern="^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$">
        <button onclick="convertHex()">转换为RGB</button>
        <div class="preview-box" id="hexPreview"></div>
        <div class="result" id="hexResult"></div>
    </div>

    <script>
        // 顶部实时取色器保持不变...

        function convertRgb() {
            const input = document.getElementById('rgbInput').value.trim();
            // 支持纯数值输入的新正则表达式
            const regex = /^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([\d.]+))?\s*$/;
            const match = input.match(regex);

            if (!match) {
                showError('rgbResult', '格式错误！请输入有效的RGB/RGBA值');
                return;
            }

            const [r, g, b, a] = [match[1], match[2], match[3], match[4]].map(Number);
            
            // 验证数值范围
            if ([r, g, b].some(v => v < 0 || v > 255)) {
                showError('rgbResult', 'RGB值应在0-255之间');
                return;
            }
            if (a !== undefined && (a < 0 || a > 1)) {
                showError('rgbResult', '透明度应在0-1之间');
                return;
            }

            // 转换逻辑保持不变
            const toHex = (c) => c.toString(16).padStart(2, '0');
            const hex = `#${toHex(r)}${toHex(g)}${toHex(b)}`;
            
            // 显示带透明度的预览
            document.getElementById('rgbPreview').style.backgroundColor = 
                a ? `rgba(${r},${g},${b},${a})` : hex;
            
            const resultText = a 
                ? `HEX: ${hex}（透明度${a}将被忽略）` 
                : `HEX: ${hex}`;
                
            document.getElementById('rgbResult').innerHTML = `
                <span style="color: ${hex}; font-weight: bold;">${resultText}</span>
                <button onclick="copyToClipboard('${hex}')" style="margin-left: 10px; padding: 2px 8px;">
                    复制
                </button>`;
        }

        // 修改convertHex函数
        function convertHex() {
            const input = document.getElementById('hexInput').value.trim();
            if (!/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(input)) {
                showError('hexResult', '请输入有效的HEX颜色值（如：#000 或 #000000）');
                return;
            }

            let hex = input.substring(1);
            if (hex.length === 3) {
                hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
            }

            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            const rgbValue = `rgb(${r}, ${g}, ${b})`;

            document.getElementById('hexPreview').style.backgroundColor = input;
            document.getElementById('hexResult').innerHTML = `
                <span style="color: ${input}; font-weight: bold;">RGB: ${rgbValue}</span>
                <button onclick="copyToClipboard('${rgbValue}')" style="margin-left: 10px; padding: 2px 8px;">
                    复制
                </button>`;
        }

        function showError(elementId, message) {
            document.getElementById(elementId).innerHTML = 
                `<span style="color: red;">${message}</span>`;
        }
    </script>
</body>
</html>